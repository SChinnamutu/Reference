/*
 perfhr 2016-11-14 
*/
mainApp.controller("headerController",["$scope","user","profileAPIservice","dashboardAPIservice",function(a,b,c,d){c.getProfileDetails().success(function(c){a.user=c.entity,b.loggedUser=c.entity}),d.getVersion().success(function(a){$("#version").html("Version: "+a.entity)})}]),mainApp.controller("menuController",["$scope","user",function(a,b){}]),mainApp.controller("profileController",["$scope","$controller","profileAPIservice","employeeAPIservice",function(a,b,c,d){a.data=null,a.isProfile=!0,d.loadEmployees().success(function(b){a.employees=b.entity,c.getProfileDetails().success(function(b){a.data=b.entity})}),a.submit=function(){a.data&&d.updateEmployee(a.data).success(function(){perfUtils.getInstance().successMsg("Profile updated Successfully!")})},angular.extend(this,b("empProfileController",{$scope:a}))}]),mainApp.controller("empProfileController",["$scope","designationAPIservice",function(a,b){a.dob={opened:!1},a.dobDate=function(){a.dob.opened=!0},a.joinDate={opened:!1},a.joinDate=function(){a.joinDate.opened=!0},a.jobEffDate={opened:!1},a.jobEffDate=function(){a.jobEffDate.opened=!0},a.lastWorkDate={opened:!1},a.lastWorkDate=function(){a.lastWorkDate.opened=!0},a.validate=function(){perfUtils.getInstance().validateFutureDate(["birthDate","joinDate"])},b.getDesignationDetails().success(function(b){a.designations=b.entity})}]),mainApp.factory("profileAPIservice",["$http",function(a){var b={};return b.getProfileDetails=function(){return a({method:"get",url:perfUrl.loadEmployee})},b}]),function(a){var b=function(b,c,d,e,f,g){b.loadEmployees=function(){d.loadEmployees().success(function(a){b.employees=a.entity,b.dtInstance.DataTable.clear().draw(),b.dtInstance.DataTable.rows.add(b.employees).draw()})},b.loadEmployees(),b.addEmployee=function(){b.data={},perfUtils.getInstance().resetForm(),$("#employeeForm").modal()},b.save=function(){d.addEmployee(b.data).success(function(){perfUtils.getInstance().successMsg("Employee Saved Successfully!"),b.dtInstance.reloadData(),$("#employeeForm").modal("hide")})},b.update=function(){d.updateEmployee(b.data).success(function(){b.dtInstance.dataTable.fnUpdate(b.data,b.dtInstance.DataTable.$("tr.selected"),void 0,!1),perfUtils.getInstance().successMsg("Employee updated Successfully!"),$("#employeeForm").modal("hide")})},b.dtColumns=[e.newColumn("employeeId").withTitle("ID"),e.newColumn("firstName").withTitle("First Name").renderWith(function(a,b,c){return c.firstName+" "+c.lastName}),e.newColumn("superviserFirstName").withTitle("Supervisor").notVisible().renderWith(function(a,b,c){return c.superviserFirstName+" "+c.superviserLastName}),e.newColumn("email").withTitle("Email"),e.newColumn("designations.designation").withTitle("Designation")],b.title="Employees";var h={vm:b,compile:f,DtOptionsBuilder:g,DTColumnBuilder:e,service:d,editFormId:"employeeForm",sortCol:1,sEmptyTable:"Loading..",deleteRow:!1};perfDatatable.loadTable.init(h),a.extend(this,c("empProfileController",{$scope:b}))};b.$inject=["$scope","$controller","employeeAPIservice","DTColumnBuilder","$compile","DTOptionsBuilder"],mainApp.controller("employeeController",b)}(angular),mainApp.factory("employeeAPIservice",["$http",function(a){var b={};return b.loadById=function(b){return a({method:"get",url:perfUrl.loadEmployeeById+b})},b.loadAllEmployees=function(){return a({method:"get",url:perfUrl.loadAllEmployees})},b.loadEmployees=function(){return a({method:"get",url:perfUrl.loadEmployees})},b.addEmployee=function(b){return a({method:"post",data:b,url:perfUrl.addEmployee})},b.updateEmployee=function(b){return a({method:"put",data:b,url:perfUrl.updateEmployee})},b.loadEmployeeByDesHistory=function(b,c,d){return a({method:"get",url:perfUrl.loadEmployeeByDesHistory.replace("{fromDate}",b).replace("{toDate}",c).replace("{designation}",d)})},b}]),mainApp.controller("dashboardController",function(a,b){}).controller("approvalReqCtrl",function(){}),mainApp.factory("dashboardAPIservice",["$http",function(a){var b={};return b.getVersion=function(){return a({ContentType:"application/text",method:"get",url:perfUrl.getVersion})},b}]),function(a){var b=function(b,c,d){var e=this;b.dtColumns=[d.newColumn("designation").withTitle("Job Title"),d.newColumn("sbu").withTitle("SBU")];var f={title:"Job Title",formId:"designationForm",scope:b,addUrl:perfUrl.addDesignation,updateUrl:perfUrl.updateDesignation,deleteUrl:perfUrl.deleteDesignation,loadListUrl:perfUrl.loadDesignations};a.extend(this,c("AbstractController",{_this:e,vm:f}))};b.$inject=["$scope","$controller","DTColumnBuilder"],mainApp.controller("designationController",b)}(angular),mainApp.factory("designationAPIservice",["$http",function(a){var b={};return b.getDesignationDetails=function(){return a({method:"get",url:perfUrl.loadDesignations})},b.loadById=function(b){return a({method:"get",url:perfUrl.loadDesignationById+b})},b.addDesignation=function(b){return a({method:"post",data:b,url:perfUrl.addDesignation})},b.updateDesignation=function(b){return a({method:"put",data:b,url:perfUrl.updateDesignation})},b.deleteDesignation=function(b){return a({method:"put",data:b,url:perfUrl.deleteDesignation})},b}]),function(a){var b=function(b,c,d){var e=this;b.stDate={opened:!1},b.endDate={opened:!1},b.prStartDate=function(){b.stDate.opened=!0},b.prEndDate=function(){b.endDate.opened=!0},b.validate=function(){perfUtils.getInstance().compareDate()},b.dtColumns=[d.newColumn("projectName").withTitle("Projects"),d.newColumn("startDate").withTitle("Start Date").renderWith(function(a){return moment(a).format("DD-MMM-YYYY")}),d.newColumn("endDate").withTitle("End Date").renderWith(function(a){return moment(a).format("DD-MMM-YYYY")})];var f={title:"Project",formId:"projectForm",scope:b,addUrl:perfUrl.addProject,updateUrl:perfUrl.updateProject,deleteUrl:perfUrl.deleteProject,loadListUrl:perfUrl.loadProjects};a.extend(this,c("AbstractController",{_this:e,vm:f}))};b.$inject=["$scope","$controller","DTColumnBuilder"],mainApp.controller("projectController",b)}(angular),mainApp.factory("projectAPIservice",["$http",function(a){var b={};return b.loadById=function(b){return a({method:"get",url:perfUrl.loadProjectById+b})},b.loadProjects=function(){return a({method:"get",url:perfUrl.loadProjects})},b.addProject=function(b){return a({method:"post",data:b,url:perfUrl.addProject})},b.updateProject=function(b){return a({method:"put",data:b,url:perfUrl.updateProject})},b.deleteProject=function(b){return a({method:"put",data:b,url:perfUrl.deleteProject})},b}]),function(a){var b=function(b,c,d){var e=this;b.dtColumns=[d.newColumn("roleName").withTitle("Roles")];var f={title:"Role",formId:"rolesForm",scope:b,addUrl:perfUrl.addRoles,updateUrl:perfUrl.updateRoles,deleteUrl:perfUrl.deleteRoles,loadListUrl:perfUrl.loadRoles};a.extend(this,c("AbstractController",{_this:e,vm:f}))};b.$inject=["$scope","$controller","DTColumnBuilder"],mainApp.controller("rolesController",b)}(angular),mainApp.factory("rolesAPIservice",["$http",function(a){var b={};return b.getRolesDetails=function(){return a({method:"get",url:perfUrl.loadRoles})},b.loadById=function(b){return a({method:"get",url:perfUrl.loadRolesById+b})},b.addRoles=function(b){return a({method:"post",data:b,url:perfUrl.addRoles})},b.updateRoles=function(b){return a({method:"put",data:b,url:perfUrl.updateRoles})},b.deleteRoles=function(b){return a({method:"put",data:b,url:perfUrl.deleteRoles})},b}]),function(a){var b=function(b,c,d){var e=this;b.dtColumns=[d.newColumn("componentName").withTitle("Components")];var f={title:"Component",formId:"componentsForm",scope:b,addUrl:perfUrl.addComponent,updateUrl:perfUrl.updateComponent,deleteUrl:perfUrl.deleteComponent,loadListUrl:perfUrl.loadComponents};a.extend(this,c("AbstractController",{_this:e,vm:f}))};b.$inject=["$scope","$controller","DTColumnBuilder"],mainApp.controller("componentsController",b)}(angular),mainApp.factory("componentsAPIservice",["$http",function(a){var b={};return b.getComponentsDetails=function(){return a({method:"get",url:perfUrl.loadComponents})},b.loadById=function(b){return a({method:"get",url:perfUrl.loadComponentsById+b})},b.addComponents=function(b){return a({method:"post",data:b,url:perfUrl.addComponent})},b.updateComponents=function(b){return a({method:"put",data:b,url:perfUrl.updateComponent})},b.deleteComponents=function(b){return a({method:"put",data:b,url:perfUrl.deleteComponent})},b}]),function(a){var b=function(b,c,d,e,f){var g=this;b.pmStDate={opened:!1},b.pmEndDate={opened:!1},b.pmStartDate=function(){b.pmStDate.opened=!0},b.pmEndDate=function(){b.pmEndDate.opened=!0},e.loadProjects().success(function(a){b.projects=a.entity}),f.loadAllEmployees().success(function(a){b.employees=a.entity}),b.validate=function(){perfUtils.getInstance().compareDate(),console.log("st dt ",b.data.projectId.startDate)},b.dtColumns=[d.newColumn("projectId.projectName").withTitle("Project Name"),d.newColumn("employeeId").withTitle("Employee Name").renderWith(function(a){return a.firstName+", "+a.lastName}),d.newColumn("employeeId.designations.designation").withTitle("Designation"),d.newColumn("dtStarted").withTitle("Start Date").renderWith(function(a){return moment(a).format("DD-MMM-YYYY")}),d.newColumn("dtEnded").withTitle("End Date").renderWith(function(a){return moment(a).format("DD-MMM-YYYY")})];var h={title:"Project Members",formId:"projectMembersForm",scope:b,addUrl:perfUrl.saveProjectMember,updateUrl:perfUrl.updateProjectMember,deleteUrl:perfUrl.deleteProjectMember,loadListUrl:perfUrl.loadAllProjectMembers};a.extend(this,c("AbstractController",{_this:g,vm:h}))};b.$inject=["$scope","$controller","DTColumnBuilder","projectAPIservice","employeeAPIservice"],mainApp.controller("projectMembersController",b)}(angular),mainApp.factory("projectMemberAPIservice",["$http",function(a){var b={};return b.loadById=function(b){return a({method:"get",url:perfUrl.loadProjectMemberById+b})},b.loadAllProjectMembers=function(){return a({method:"get",url:perfUrl.loadAllProjectMembers})},b.saveProjectMember=function(b){return a({method:"post",data:b,url:perfUrl.saveProjectMember})},b.updateProjectMember=function(b){return a({method:"put",data:b,url:perfUrl.updateProjectMember})},b.deleteProjectMember=function(b){return a({method:"put",data:b,url:perfUrl.deleteProjectMember})},b}]),mainApp.controller("importPtoController",function(a,b){$(document).on("change",":file",function(){var a=$(this),b=a.get(0).files?a.get(0).files.length:1,c=a.val().replace(/\\/g,"/").replace(/.*\//,"");a.trigger("fileselect",[b,c])}),$(":file").on("fileselect",function(a,b,c){var d=$(this).parents(".input-group").find(":text"),e=b>1?b+" files selected":c;d.length?d.val(e):e&&alert(e)}),a.uploadFile=function(){var c=a.uploadPto;b.uploadFileToUrl(c).success(function(b){$('input[type="file"]').val(""),b?perfUtils.getInstance().successMsg("PTO document processed successfully!"):a.msg="An error occurred during document processing!"})}}),mainApp.factory("ptoAPIService",["$http",function(a){var b={};return b.uploadFileToUrl=function(b){var c=new FormData;return c.append("uploadFiles",b),a({method:"post",data:c,url:perfUrl.importPto,transformRequest:angular.identity,headers:{"Content-Type":void 0}})},b.carryLeaves=function(b){return a({method:"post",url:perfUrl.carryLeaves.replace("{year}",b)})},b}]),function(a){mainApp.controller("wfhController",function(b,c){var d=this;d.events=[],b.title="WFH",b.leaveType="WFH",b.btnTheme="btn-danger",a.extend(this,c("leaveController",{$scope:b}))}),mainApp.controller("ptoController",function(b,c){var d=this;d.events=[],b.title="PTO",b.leaveType="PTO",b.isPto=!0,b.btnTheme="btn-success",a.extend(this,c("leaveController",{$scope:b}))}),mainApp.filter("propsFilter",function(){return function(b,c){var d=[];if(a.isArray(b)){var e=Object.keys(c);b.forEach(function(a){for(var b=!1,f=0;f<e.length;f++){var g=e[f],h=c[g].toLowerCase();if(a[g].toString().toLowerCase().indexOf(h)!==-1){b=!0;break}}b&&d.push(a)})}else d=b;return d}});var b=function(a,b,c,d,e,f,g,h,i){function j(a){return Math.round(2*a)/2}var k=this;k.calendarView="month",k.viewDate=new Date,k.viewChangeEnabled=!0,k.checkLeaves="all",k.calYear=new Date(k.viewDate).getFullYear(),k.calMonth=new Date(k.viewDate).getMonth(),scope=a,a.data={},a.employees=[],a.employeesList,a.leaveBalance=0,a.data.requestType=a.leaveType;var l=[];f.displayEventEndTimes=!0,f.templates.calendarSlideBox="html/templates/calendarSlideBoxTemplate.html",f.templates.calendarMonthCell="html/templates/calendarMonthCell.html",f.templates.calendarMonthCellEvents="html/templates/calendarMonthCellEvents.html",this.toggle=function(a,b,c){a.preventDefault(),a.stopPropagation(),c[b]=!c[b]},this.timeSpanClicked=function(b,c){b.events.length>0&&(a.dtInstance.DataTable.clear().draw(),a.dtInstance.DataTable.rows.add(b.events).draw(),$("#leaveList").modal())},a.toggleYear=function(b){k.calYear!==new Date(b).getFullYear()&&(k.calYear=new Date(b).getFullYear(),a.toggleLeave(k.checkLeaves)),k.calMonth=new Date(b).getMonth(),a.getLeaveBalance(),a.getCarryLeaves()},a.getCarryLeaves=function(){var e=b(c.loggedUser.joinDate).year();a.carriedOn=0,a.isPto&&e<k.calYear&&d.getCarryLeaves(k.calYear-1).success(function(d){var f=d.entity/8;if(k.calYear-1===e){var g=j(1.67*(12-b(c.loggedUser.joinDate).month())).toFixed(1);a.carriedOn=g-f>10?10:g-f}else a.carriedOn=20-f>10?10:20-f})},a.getCarryLeaves(),a.openModal=function(){$("#leaveModal").modal()},a.applyLeave=function(){a.data={},a.data.employeeId=c.loggedUser.pk,a.data.notificationToList=[],a.data.notificationToList.push(a.employees[getIndex(c.loggedUser.pk)],a.employees[getIndex(c.loggedUser.supervisor)]),a.data.requestType=a.leaveType,a.data.dtEndHalf="SECOND",a.data.dtFromHalf="FIRST",a.openModal()},getIndex=function(b){var c=a.employees.findIndex(function(a,c){return a.pk===b});return c},e.loadEmployees().success(function(b){a.employeesList=b.entity,a.employees=b.entity,a.toggleLeave(k.checkLeaves),a.getLeaveBalance()}),a.toggleLeave=function(b){k.checkLeaves=b,"all"===b?d.loadAllLeaves(a.leaveType,k.calYear).success(function(b){a.displayLeave(b.entity)}):d.loadMyLeaves(a.leaveType,k.calYear).success(function(b){a.displayLeave(b.entity)})},a.validate=function(){perfUtils.getInstance().compareDate()},a.getLeaveBalance=function(){var e=b(c.loggedUser.joinDate).format("DD/MM/YYYY");if(b(e,"DD/MM/YYYY").year()===k.calYear){var f=k.calMonth+1-b(e,"DD/MM/YYYY").month();f=f<0?0:f,d.getLeaveBalance(a.leaveType,k.calYear,k.calMonth+1).success(function(b){a.leaveBalance=j((b.entity/8).toFixed(1))+"/"+j((1.67*f).toFixed(1))})}else if(b(e,"DD/MM/YYYY").year()<=k.calYear){var f=k.calMonth+1;d.getLeaveBalance(a.leaveType,k.calYear,k.calMonth+1).success(function(b){a.leaveBalance=j((b.entity/8).toFixed(1))+"/"+j((1.67*f).toFixed(1))})}else a.leaveBalance="0/0"},a.displayLeave=function(b){a.scope.events.splice(0,a.scope.events.length),$.each(b,function(b,c){c.startsAt=new Date(c.startsAt),c.endsAt=new Date(c.endsAt),c.type=a.displayType;var d=[];c.notificationToList&&($.each(c.notificationToList,function(a,b){d.push(b.pk)}),c.notificationToList.splice(0,c.notificationToList.length),$.each(d,function(b,d){c.notificationToList.push(a.employees[getIndex(d)])})),a.scope.events[c.pk]=c,l[c.pk]=b})},a.saveLeave=function(){a.data.requestType=a.leaveType,$.each(a.data.notificationToList,function(a,b){void 0!==b._uiSelectChoiceDisabled&&delete b._uiSelectChoiceDisabled}),d.applyLeave(a.data).success(function(b){b.startsAt=new Date(b.entity.startsAt),b.endsAt=new Date(b.entity.endsAt),a.scope.events[b.entity.pk]=b.entity,perfUtils.getInstance().successMsg(a.title+" Saved Successfully!"),$("#leaveModal").modal("hide"),a.getLeaveBalance()})},a.updateLeave=function(){$.each(a.data.notificationToList,function(a,b){void 0!==b._uiSelectChoiceDisabled&&delete b._uiSelectChoiceDisabled}),d.updateLeave(a.data).success(function(b){$.grep(a.scope.events,function(b,c){return a.data.pk===b.pk&&(a.scope.events[c]=a.data),b.pk===a.data.pk}),a.data.hours=b.entity.hours,a.dtInstance.dataTable.fnUpdate(a.data,a.dtInstance.DataTable.$("tr.selected"),void 0,!1),perfUtils.getInstance().successMsg(a.title+" Updated Successfully!"),$("#leaveModal").modal("hide"),a.getLeaveBalance()})},a.deleteLeave=function(){d.deleteLeave(a.data).success(function(){$.grep(a.scope.events,function(b,c){return a.data.pk===b.pk&&a.scope.events.splice(c,1),b.pk===a.data.pk}),a.message(a.title+" Deleted Successfully!"),perfUtils.getInstance().successMsg(a.title+" Deleted Successfully!"),$("#deleteLeave").modal("hide"),a.getLeaveBalance()})},a.onDtChange=function(){var b=324e5,c=486e5,d=63e6;if(a.data.startsAt&&a.data.dtFromHalf){var e=new Date(a.data.startsAt).toDateString();e="FIRST"===a.data.dtFromHalf?new Date(e).getTime()+b:new Date(e).getTime()+c,a.data.startsAt=new Date(e)}if(a.data.endsAt&&a.data.dtEndHalf){var f=new Date(a.data.endsAt).toDateString();f="FIRST"===a.data.dtEndHalf?new Date(f).getTime()+c:new Date(f).getTime()+d,a.data.endsAt=new Date(f)}},a.dtColumns=[g.newColumn("title").withTitle("Title"),g.newColumn("employeeView").withTitle("Employee Name").renderWith(function(a,b,c){return c.employeeView.firstName+" "+c.employeeView.lastName}),g.newColumn("startsAt").withTitle("Starts").renderWith(function(a){return b(a).format("DD-MMM-YYYY hh:mm A")}),g.newColumn("endsAt").withTitle("Ends").renderWith(function(a){return b(a).format("DD-MMM-YYYY hh:mm A")}),g.newColumn("hours").withTitle("Days").renderWith(function(a){return a/8})];var m={vm:a,compile:h,DtOptionsBuilder:i,DTColumnBuilder:g,service:d,editFormId:"leaveModal",deleteRow:!1};perfDatatable.loadTable.init(m)};b.$inject=["$scope","moment","user","leaveAPIservice","employeeAPIservice","calendarConfig","DTColumnBuilder","$compile","DTOptionsBuilder"],mainApp.controller("leaveController",b)}(angular),mainApp.factory("leaveAPIservice",["$http",function(a){var b={};return b.loadAllLeaves=function(b,c){return a({method:"get",url:perfUrl.loadAllLeaves.replace("{leaveType}",b).replace("{calYear}",c)})},b.applyLeave=function(b){return a({method:"post",data:b,url:perfUrl.applyLeave})},b.updateLeave=function(b){return a({method:"put",data:b,url:perfUrl.updateLeave})},b.deleteLeave=function(b){return a({method:"put",data:b,url:perfUrl.deleteLeave})},b.loadById=function(b){return a({method:"get",url:perfUrl.loadLeaveById+b})},b.loadMyLeaves=function(b,c){return a({method:"get",url:perfUrl.loadMyLeaves.replace("{leaveType}",b).replace("{calYear}",c)})},b.getLeaveBalance=function(b,c,d){return a({method:"get",url:perfUrl.getLeaveBalance.replace("{leaveType}",b).replace("{calYear}",c).replace("{calMonth}",d)})},b.loadLeaveReport=function(b){return a({method:"post",data:b,url:perfUrl.loadLeaveReport})},b.loadAllLeaveReport=function(b){return a({method:"post",data:b,url:perfUrl.loadAllLeaveReport})},b.getCarryLeaves=function(b){return a({method:"get",url:perfUrl.getCarryLeaves.replace("{year}",b)})},b}]),function(a){function b(a,b,c,d,g){e=this,f=d,e.dtColumns=[d.newColumn("sbu").withTitle("SBU"),d.newColumn("designation").withTitle("Job Title").notVisible(),d.newColumn("employeeCount").withTitle("Count")],h={vm:e,scope:a,compile:b,DtOptionsBuilder:c,DTColumnBuilder:d,service:g,actions:!1},perfDatatable.loadTable.init(h)}function c(a,b,c,e,f){d=this,d.dtColumns=[e.newColumn("employeeId").withTitle("ID"),e.newColumn("firstName").withTitle("First Name").renderWith(function(a,b,c){return c.firstName+" "+c.lastName}),e.newColumn("superviserFirstName").withTitle("Supervisor").notVisible().renderWith(function(a,b,c){return c.superviserFirstName+" "+c.superviserLastName}),e.newColumn("email").withTitle("Email"),e.newColumn("designations.designation").withTitle("Designation")],h={vm:d,scope:a,compile:b,DtOptionsBuilder:c,DTColumnBuilder:e,service:f,sortCol:1,actions:!1},perfDatatable.loadTable.init(h)}var d,e,f,g,h;mainApp.controller("reportsJobtitleController",function(a,b,c){function f(b){0===a.brIndex?(a.sbu=null,a.designation=null,b&&(b.dtInstance.dataTable.fnSetColumnVis(0,!0),b.dtInstance.dataTable.fnSetColumnVis(1,!1))):1===a.brIndex?(a.designation=null,b&&(b.dtInstance.dataTable.fnSetColumnVis(0,!1),b.dtInstance.dataTable.fnSetColumnVis(1,!0))):2===a.brIndex&&a.loadEmployeeByDesHistory(),a.brIndex<=1&&a.loadBySbu()}g=a,a.data={},a.brIndex=0,a.stDate={opened:!1},a.endDate={opened:!1},a.reportStartDate=function(){a.stDate.opened=!0},a.reportEndDate=function(){a.endDate.opened=!0},g.startsAt=new Date((new Date).getFullYear()+"-01-01"),g.endsAt=new Date((new Date).getFullYear()+"-12-31"),$("table").on("click","tbody tr",function(){a.brIndex<=1&&("CHENNAI CONSULTING"===$(this).find("td:first").html()||"CHENNAI ADMIN"===$(this).find("td:first").html()?0===a.brIndex&&($("#jobTitleBreadCrumb").append("<li>"+$(this).find("td:first").html()+"</li>"),a.sbu=$(this).find("td:first").html(),a.brIndex++,f(e)):1===a.brIndex&&($("#jobTitleBreadCrumb").append("<li>"+$(this).find("td:first").html()+"</li>"),a.designation=$(this).find("td:first").html(),a.brIndex++,f(e)))}),$("#jobTitleBreadCrumb").on("click","li",function(){a.brIndex=$("#jobTitleBreadCrumb li").index(this),$("#jobTitleBreadCrumb li:gt("+a.brIndex+")").remove(),f(e)}),a.loadBySbu=function(){b.reportsLoadBySbu(g.startsAt.getTime(),g.endsAt.getTime(),a.sbu,a.designation).success(function(a){e.dtInstance.DataTable.clear().draw(),e.dtInstance.DataTable.rows.add(a.entity).draw()})},a.loadEmployeeByDesHistory=function(){c.loadEmployeeByDesHistory(g.startsAt.getTime(),g.endsAt.getTime(),a.designation).success(function(b){a.employees=b.entity,d.dtInstance.DataTable.clear().draw(),d.dtInstance.DataTable.rows.add(a.employees).draw()})},a.validate=function(){perfUtils.getInstance().compareDate()},f(),a.searchLeave=function(){f()}}),mainApp.controller("reportJobTitleControllerTable",b),mainApp.controller("employeeTableCtrl",c)}(angular),mainApp.factory("reportJobtitleAPIservice",["$http",function(a){var b={};return b.reportsLoadBySbu=function(b,c,d,e){return a({method:"get",url:perfUrl.reportsLoadBySbu.replace("{fromDate}",b).replace("{toDate}",c).replace("{sbu}",d).replace("{designation}",e)})},b}]),function(a){function b(a,b,c,e,f){d=this,d.dtColumns=[e.newColumn("pk").withTitle("id").notVisible().renderWith(function(a,b,c){return c[1]}),e.newColumn("employeeId").withTitle("Employee Id").renderWith(function(a,b,c){return c[1]}),e.newColumn("employeeView").withTitle("Employee Name").renderWith(function(a,b,c){return c[2]+" "+c[3]}),e.newColumn("hours").withTitle("Leaves Taken").renderWith(function(a,b,c){return c[4]/8})],"PTO"===a.title&&d.dtColumns.push(e.newColumn("balance").withTitle("Total Leaves").renderWith(function(a,b,c){return c[5]}),e.newColumn("balance").withTitle("Carried Leaves").renderWith(function(a,b,c){return c[0]}));var g={vm:d,scope:a,compile:b,DtOptionsBuilder:c,DTColumnBuilder:e,service:f,editFormId:"leaveModal",actions:!1};perfDatatable.loadTable.init(g),console.log("in search ",a.title)}function c(a,b,c,d,f){e=this,e.dtColumns=[d.newColumn("title").withTitle("Title"),d.newColumn("employeeView").withTitle("Employee Name").renderWith(function(a,b,c){return c.employeeView.firstName+" "+c.employeeView.lastName}),d.newColumn("requestType").withTitle("Type").renderWith(function(a,b,c){return c.requestType}),d.newColumn("comments").withTitle("Comments").renderWith(function(a,b,c){return c.comments}),d.newColumn("startsAt").withTitle("Starts").renderWith(function(a){return moment(a).format("DD-MMM-YYYY hh:mm A")}),d.newColumn("endsAt").withTitle("Ends").renderWith(function(a){return moment(a).format("DD-MMM-YYYY hh:mm A")}),d.newColumn("hours").withTitle("Days").renderWith(function(a){return a/8})];var g={vm:e,scope:a,compile:b,DtOptionsBuilder:c,DTColumnBuilder:d,service:f,editFormId:"leaveModal",actions:!1,sortCol:3};perfDatatable.loadTable.init(g)}var d,e,f;mainApp.controller("wfhReportController",function(b,c){b.title="WFH",b.requestType="WFH",a.extend(this,c("leaveReportController",{$scope:b}))}),mainApp.controller("ptoReportController",function(b,c){b.title="PTO",b.requestType="PTO",b.isPto=!0,a.extend(this,c("leaveReportController",{$scope:b}))}),mainApp.controller("leaveReportController",function(a,b,c,g){f=a,a.data={},a.stDate={opened:!1},a.endDate={opened:!1},a.reportStartDate=function(){a.stDate.opened=!0},a.reportEndDate=function(){a.endDate.opened=!0},a.data.requestType=a.requestType,a.validate=function(){perfUtils.getInstance().compareDate()},a.searchLeave=function(){c.loadAllLeaveReport(a.data).success(function(b){"PTO"===a.title&&$.each(b.entity,function(b,c){c[0]=a.getCarryLeaves(c),c[5]=Math.round(1.67*a.getLeaveBalance(new Date(c[5]).getTime())*2)/2}),d.dtInstance.DataTable.clear().draw(),d.dtInstance.DataTable.rows.add(b.entity).draw()})},a.getCarryLeaves=function(c){var d=b(c[5]).year(),e=0,f=new Date(a.data.startsAt).getFullYear();if("PTO"===a.title&&d<f){var g=c[0]/8;if(f-1===d){var h=Math.round(1.67*(12-b(c[5]).month())).toFixed(1);return e=h-g>10?10:h-g}return e=20-g>10?10:20-g}return e},a.getLeaveBalance=function(c){var d=new Date(a.data.startsAt),e=new Date(a.data.endsAt),f=b(c).year()+" "+(b(c).month()+1)+" 01",g=d.getFullYear()+" "+(d.getMonth()+1)+" 01",h=e.getFullYear()+" "+(e.getMonth()+1)+" 31";return c>=d.getTime()&&c<=e.getTime()?b(h,"yyyy MM dd").diff(b(f,"yyyy MM dd"),"months",!0):c<=d.getTime()?b(h,"yyyy MM dd").diff(b(g,"yyyy MM dd"),"months",!0):0},$(document).on("click","#leaveReportTable table.dataTable tbody tr",function(){a.data.empId=$(this).find("td:eq(0)").html(),c.loadLeaveReport(a.data).success(function(a){e.dtInstance.DataTable.clear().draw(),e.dtInstance.DataTable.rows.add(a.entity).draw(),$("#leaveTableList").modal()})}),g.loadEmployees().success(function(b){a.employees=b.entity})}),mainApp.controller("leaveReportControllerTable",b),mainApp.controller("leaveSplitUpControllerTable",c)}(angular),function(a){var b=function(a,b,c,d,e,f,g,h){c.getRolesDetails().success(function(b){a.roles=b.entity}),a.data={},a.data.employee=[],d.loadAllEmployees().success(function(b){a.employeeList=b.entity}),a.manageRoles=function(){e.saveEmpRoles(a.data).success(function(){perfUtils.getInstance().successMsg("Employee Roles Saved Successfully!"),a.onRoleChange()})},a.onRoleChange=function(){e.loadEmpByRoles(a.data.role.pk).success(function(b){a.data.employee=[],$.each(b.entity,function(b,c){a.data.employee.push(c.employee)})})},a.manageRoles=function(){console.log("in apply ",$('form input[type="checkbox"]')),$.each($('form input[type="checkbox"]'),function(a,b){console.log("name ",b.id," value ",$(b).prop("checked"))})};var i={components:[{name:"Administration",type:"Menu",child:[{name:"JobTitle",type:"Page",btn:[{name:"Save",type:"btn"},{name:"Update",type:"btn"},{name:"Delete",type:"btn"}]},{name:"Roles",type:"Page"}]},{name:"Employees",type:"Page"}]},j="";a.createComponentHtml=function(b){var c=a.createComponent(b);return b.child&&$.each(b.child,function(b,d){c+='<ul><li class="well">',c+=a.createComponentHtml(d),d.btn&&(c+="<ul><li>",$.each(d.btn,function(b,d){c+=a.createComponent(d)}),c+="</li></ul>"),c+="</li></ul>"}),c},a.createComponent=function(a){var b="btn-default";"Menu"===a.type?b="btn-info":"Page"===a.type?b="btn-primary":"btn"===a.type&&(console.log("in btn"),a.name.includes("Save")?b="btn-success":a.name.includes("Upd")?b="btn-warning":a.name.includes("Del")&&(b="btn-danger"));var c='<input type="checkbox" name="" id="'+a.name+'" autocomplete="off" />';return c+='<div class="[ btn-group ]">',c+='<label for="'+a.name+'" class="[ btn '+b+' ]">',c+='<span class="[ glyphicon glyphicon-check ]"></span>',c+='<span class="[ glyphicon glyphicon-unchecked ]"></span>',c+="</label>",c+='<label for="'+a.name+'" class="[ btn '+b+' active ]">',c+=a.name,c+="</label>",c+="</div>"},$.each(i.components,function(b,c){j+='<li class="well">'+a.createComponentHtml(c)+"</li>"}),$("#componentsList").html(j),$('input[type="checkbox"]').click(function(){$(this).prop("checked")?$.each($(this).parent("li").parents("li").children('input[type="checkbox"]'),function(a,b){$(this).prop("checked")||$(this).prop("checked",!0)}):$(this).parent("li").find('input[type="checkbox"]').prop("checked",!1)}),a.dtColumns=[f.newColumn("roleId").withTitle("Role Name").renderWith(function(a,b,c){return a.roleName}),f.newColumn("employee").withTitle("Employee").renderWith(function(a,b,c){return a.firstName+" "+a.lastName})];var k={vm:a,title:"Employee Roles Management",compile:g,DtOptionsBuilder:h,DTColumnBuilder:f,service:e,sortCol:1,sEmptyTable:"Loading.."};perfDatatable.loadTable.init(k)};b.$inject=["$scope","$controller","rolesAPIservice","employeeAPIservice","emprolesAPIservice","DTColumnBuilder","$compile","DTOptionsBuilder"],mainApp.controller("empRolesController",b)}(angular),mainApp.factory("emprolesAPIservice",["$http",function(a){var b={};return b.loadEmpByRoles=function(b){return a({method:"get",url:perfUrl.loadEmpByRoles+b})},b.loadNonEmpByRoles=function(b){return a({method:"get",url:perfUrl.loadNonEmpByRoles+b})},b.saveEmpRoles=function(b){return a({method:"post",data:b,url:perfUrl.saveEmpRoles})},b}]),function(a){var b=function(b,c,d){var e=this;b.projectGoals=[],b.addProject=function(){b.projectGoals.push({Name:b.name,Desc:b.desc,selfEvaln:b.selfEvaln,pmEvaln:b.pmEvaln})},b.dtColumns=[d.newColumn("year").withTitle("Year"),d.newColumn("projectRating").withTitle("Project Rating"),d.newColumn("utilRating").withTitle("Utiliziation Rating")];var f={title:"Goals",formId:"goalsForm",scope:b,addUrl:perfUrl[""],updateUrl:perfUrl[""],deleteUrl:perfUrl[""],loadListUrl:""};a.extend(this,c("AbstractController",{_this:e,vm:f}))};b.$inject=["$scope","$controller","DTColumnBuilder"],mainApp.controller("empGoalsController",b)}(angular);